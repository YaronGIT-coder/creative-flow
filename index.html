<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Flow | Production Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0B0B0F;
            --bg-medium: #16161D;
            --bg-card: #1C1C26;
            
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-success: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0B8;
            --text-dim: #6B6B7C;
            
            --border: rgba(255, 255, 255, 0.08);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            background: var(--bg-medium);
            border-bottom: 1px solid var(--border);
            padding: 24px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .version-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(102, 126, 234, 0.15);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            color: #667eea;
            letter-spacing: 0.05em;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 80px;
        }

        .hero-title {
            font-size: 56px;
            font-weight: 900;
            margin-bottom: 20px;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .hero-gradient {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 20px;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Problem Grid */
        .problem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 24px;
            margin-bottom: 60px;
        }

        .problem-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .problem-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .problem-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .problem-card:hover::before {
            opacity: 1;
        }

        .problem-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
        }

        .problem-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: -0.01em;
        }

        .problem-desc {
            font-size: 15px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Solution Pages */
        .solution-page {
            display: none;
        }

        .solution-page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 40px;
            transition: all 0.2s;
        }

        .back-btn:hover {
            border-color: rgba(102, 126, 234, 0.5);
            color: var(--text-primary);
        }

        .solution-header {
            margin-bottom: 48px;
        }

        .solution-title {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .solution-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: var(--bg-medium);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background: var(--bg-card);
        }

        /* Result Box */
        .result-box {
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            margin: 24px 0;
            position: relative;
        }

        .result-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-accent);
            border-radius: 16px 16px 0 0;
        }

        .result-category {
            font-size: 12px;
            font-weight: 700;
            color: #4facfe;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 12px;
        }

        .result-main {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 16px;
            letter-spacing: -0.01em;
        }

        .result-desc {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        /* Checkbox */
        .checkbox-group {
            display: grid;
            gap: 12px;
            margin: 24px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-item:hover {
            background: var(--bg-card);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 6px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .checkbox-item.checked {
            background: rgba(67, 233, 123, 0.1);
            border-color: rgba(67, 233, 123, 0.5);
        }

        .checkbox-item.checked .checkbox {
            background: var(--gradient-success);
            border-color: transparent;
        }

        .checkbox-item.checked .checkbox::after {
            content: '‚úì';
            color: white;
            font-size: 14px;
            font-weight: 700;
        }

        .checkbox-label {
            font-size: 15px;
            font-weight: 500;
        }

        /* Input Fields */
        input[type="number"],
        select {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            background: var(--bg-card);
        }

        label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            display: block;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Grid Layouts */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        /* Tip Box */
        .tip-box {
            background: rgba(255, 230, 109, 0.08);
            border: 1px solid rgba(255, 230, 109, 0.2);
            border-left: 4px solid #ffe66d;
            padding: 24px;
            border-radius: 12px;
            margin: 24px 0;
        }

        .tip-title {
            font-size: 14px;
            font-weight: 700;
            color: #ffe66d;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .tip-text {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.7;
        }

        /* Action List */
        .action-list {
            list-style: none;
            margin: 24px 0;
        }

        .action-list li {
            background: var(--bg-medium);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            font-size: 15px;
            line-height: 1.7;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .action-list li:hover {
            border-left-color: #667eea;
            background: var(--bg-card);
        }

        .action-list li strong {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* MIDI Piano Roll Visual */
        .piano-roll {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .piano-roll-grid {
            display: grid;
            grid-template-columns: 60px 1fr;
            gap: 0;
            min-width: 600px;
        }

        .piano-keys {
            display: flex;
            flex-direction: column-reverse;
        }

        .piano-key {
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            border-right: 1px solid var(--border);
        }

        .piano-key.active {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary);
        }

        .piano-grid {
            display: grid;
            grid-template-rows: repeat(12, 24px);
            gap: 0;
        }

        .piano-row {
            display: flex;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            position: relative;
        }

        .piano-note {
            width: 60px;
            height: 100%;
            margin: 2px 4px;
            background: var(--gradient-primary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
            animation: noteAppear 0.3s ease;
        }

        @keyframes noteAppear {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .piano-beat-markers {
            display: flex;
            padding-left: 60px;
            margin-bottom: 8px;
        }

        .beat-marker {
            width: 60px;
            text-align: center;
            font-size: 10px;
            color: var(--text-dim);
            margin: 0 4px;
        }

        /* Custom Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 20px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--bg-dark);
            color: var(--text-primary);
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            text-align: center;
        }

        .modal-message {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 32px;
            white-space: pre-line;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .modal-btn-secondary {
            background: var(--bg-medium);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        /* Category Buttons Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .problem-grid {
                grid-template-columns: 1fr;
            }

            .input-grid {
                grid-template-columns: 1fr;
            }

            .category-grid {
                grid-template-columns: 1fr;
            }

            .hero-title {
                font-size: 36px;
            }

            .container {
                padding: 40px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-inner">
            <div class="logo">CREATIVE FLOW</div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <button onclick="showSolution('reference')" style="background: none; border: 1px solid var(--border); padding: 8px 16px; border-radius: 8px; color: var(--text-secondary); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                    üéµ Ref Analyzer
                </button>
                <div class="version-badge">v1.3 BETA</div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Landing Page -->
        <div id="landing" class="solution-page active">
            <div class="hero">
                <h1 class="hero-title">
                    If you're here, something's stuck.
                </h1>
                <p class="hero-subtitle">
                    That's normal. Let's move.
                </p>
            </div>

            <!-- Just Decide For Me Button -->
            <div style="text-align: center; margin-bottom: 60px;">
                <button class="btn btn-primary" onclick="justDecideForMe()" style="max-width: 500px; margin: 0 auto; font-size: 18px; padding: 24px;">
                    üé≤ JUST DECIDE FOR ME
                </button>
                <p style="font-size: 13px; color: var(--text-secondary); margin-top: 12px;">
                    Can't choose? Click here for instant direction.
                </p>
            </div>

            <!-- Quiet Moment -->
            <div style="text-align: center; padding: 60px 20px; margin: 40px 0;">
                <p style="font-size: 20px; line-height: 1.8; color: var(--text-secondary); max-width: 600px; margin: 0 auto;">
                    You don't need more sounds.<br>
                    You need the next decision.
                </p>
            </div>

            <div class="problem-grid">
                <div class="problem-card" onclick="showSolution('blank')">
                    <span class="problem-icon">üéØ</span>
                    <h3 class="problem-title">I Don't Know Where to Start</h3>
                    <p class="problem-desc">Blank project, zero ideas, need direction to begin</p>
                </div>

                <div class="problem-card" onclick="showSolution('loop')">
                    <span class="problem-icon">üîì</span>
                    <h3 class="problem-title">Stuck in a Loop</h3>
                    <p class="problem-desc">Can't move past the 8-bar loop to build a full arrangement</p>
                </div>

                <div class="problem-card" onclick="showSolution('boring')">
                    <span class="problem-icon">üòê</span>
                    <h3 class="problem-title">Track Sounds Boring</h3>
                    <p class="problem-desc">Have everything but it's not interesting or exciting</p>
                </div>

                <div class="problem-card" onclick="showSolution('transition')">
                    <span class="problem-icon">üîÑ</span>
                    <h3 class="problem-title">Need a Transition</h3>
                    <p class="problem-desc">Don't know how to move between sections smoothly</p>
                </div>

                <div class="problem-card" onclick="showSolution('melodic')">
                    <span class="problem-icon">üéπ</span>
                    <h3 class="problem-title">Need Melodic Ideas</h3>
                    <p class="problem-desc">Need melody or chord inspiration to add to my track</p>
                </div>

                <div class="problem-card" onclick="showSolution('arrangement')">
                    <span class="problem-icon">üìê</span>
                    <h3 class="problem-title">Need Arrangement Structure</h3>
                    <p class="problem-desc">Want a complete track structure to follow</p>
                </div>

                <div class="problem-card" onclick="showSolution('toomuch')">
                    <span class="problem-icon">‚úÇÔ∏è</span>
                    <h3 class="problem-title">Too Many Elements</h3>
                    <p class="problem-desc">Track is muddy, need help removing layers</p>
                </div>

                <div class="problem-card" onclick="showSolution('reference')">
                    <span class="problem-icon">üéµ</span>
                    <h3 class="problem-title">Analyze a Reference Track</h3>
                    <p class="problem-desc">I want to match a specific track's vibe and structure</p>
                </div>
            </div>
        </div>

        <!-- Blank Canvas Solution -->
        <div id="solution-blank" class="solution-page">
            <div class="back-btn" onclick="showLanding()">‚Üê Back to Problems</div>
            
            <div class="solution-header">
                <h2 class="solution-title">Let's <span class="hero-gradient">Start</span></h2>
                <p class="solution-subtitle">Get a focused starting point in 30 seconds. Build THIS, then expand.</p>
            </div>

            <div class="card">
                <h3 class="card-title">Step 1: Pick Your Vibe</h3>
                <div class="category-grid">
                    <button class="btn btn-secondary" onclick="generateStarterKit('dark')">üåë Dark & Hypnotic</button>
                    <button class="btn btn-secondary" onclick="generateStarterKit('groovy')">üï∫ Groovy & Funky</button>
                    <button class="btn btn-secondary" onclick="generateStarterKit('energetic')">‚ö° Energetic & Peak-Time</button>
                    <button class="btn btn-secondary" onclick="generateStarterKit('dreamy')">‚òÅÔ∏è Dreamy & Atmospheric</button>
                </div>
                <button class="btn btn-primary" onclick="generateStarterKit('random')">üé≤ Surprise Me</button>
            </div>

            <div id="starter-kit-output" style="display: none;">
                <div class="card">
                    <h3 class="card-title">Your Starter Kit</h3>
                    <div class="result-box">
                        <div class="result-category" id="starter-vibe"></div>
                        <div class="result-main" id="starter-bpm-key"></div>
                        <div class="result-desc" id="starter-description"></div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Step 2: Build These 3 Elements (15 minutes max)</h3>
                    <ul class="action-list" id="starter-elements"></ul>
                </div>

                <div class="tip-box">
                    <div class="tip-title">‚è±Ô∏è THE 15-MINUTE RULE</div>
                    <div class="tip-text">
                        Don't overthink it. Build these 3 elements in 15 minutes. They won't be perfect - that's the point.
                        Once you have them, come back and use the other tools to expand.
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Step 3: Analyze a Reference Track</h3>
                    <p style="margin-bottom: 16px; color: var(--text-secondary);">
                        Have a track you want to sound like? Tell us about it:
                    </p>
                    <div class="input-grid">
                        <div>
                            <label>BPM</label>
                            <input type="number" id="ref-bpm-blank" placeholder="124" min="80" max="180">
                        </div>
                        <div>
                            <label>Key</label>
                            <select id="ref-key-blank">
                                <option value="">Unknown</option>
                                <option>C Minor</option>
                                <option>C# Minor</option>
                                <option>D Minor</option>
                                <option>D# Minor</option>
                                <option>E Minor</option>
                                <option>F Minor</option>
                                <option>F# Minor</option>
                                <option>G Minor</option>
                                <option>G# Minor</option>
                                <option>A Minor</option>
                                <option>A# Minor</option>
                                <option>B Minor</option>
                                <option>C Major</option>
                                <option>D Major</option>
                                <option>E Major</option>
                                <option>F Major</option>
                                <option>G Major</option>
                                <option>A Major</option>
                                <option>B Major</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-grid">
                        <div>
                            <label>Track Length (minutes)</label>
                            <input type="number" id="ref-length" placeholder="6.5" step="0.5" min="3" max="12">
                        </div>
                        <div>
                            <label>Vibe</label>
                            <select id="ref-vibe">
                                <option>Dark & Hypnotic</option>
                                <option>Groovy & Funky</option>
                                <option>Energetic & Peak-Time</option>
                                <option>Dreamy & Atmospheric</option>
                                <option>Minimal & Tech</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="analyzeReferenceDeep()">üîç Analyze Reference Track</button>
                    <div id="reference-output-blank"></div>
                </div>
            </div>
        </div>

        <!-- Boring Track Solution -->
        <div id="solution-boring" class="solution-page">
            <div class="back-btn" onclick="showLanding()">‚Üê Back to Problems</div>
            
            <div class="solution-header">
                <h2 class="solution-title">Make It <span class="hero-gradient">Interesting</span></h2>
                <p class="solution-subtitle">Your track needs movement and unexpected moments that surprise the listener</p>
            </div>

            <div class="card">
                <h3 class="card-title">What's Missing?</h3>
                <div class="category-grid">
                    <button class="btn btn-secondary" onclick="generateTechnique('movement')">Create Movement</button>
                    <button class="btn btn-secondary" onclick="generateTechnique('earcandy')">Add Ear Candy</button>
                    <button class="btn btn-secondary" onclick="generateTechnique('automation')">Automation Ideas</button>
                    <button class="btn btn-secondary" onclick="generateTechnique('texture')">Add Texture</button>
                </div>
                <button class="btn btn-primary" onclick="generateTechnique('random')">üé≤ Surprise Me</button>
                <div id="ear-candy-result"></div>
            </div>

            <div class="card">
                <h3 class="card-title">Why Tracks Sound Boring</h3>
                <ul class="action-list">
                    <li><strong>No movement:</strong> Everything stays static - automate filters, volume, panning</li>
                    <li><strong>No surprises:</strong> Every 8 bars sounds identical - add variation</li>
                    <li><strong>No space:</strong> Too dense - try removing elements to create contrast</li>
                    <li><strong>No evolution:</strong> Loop repeats too long - change something every 16 bars</li>
                </ul>
            </div>

            <div class="card" style="background: rgba(67, 233, 123, 0.05); border-color: var(--success);">
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 18px; font-weight: 700; color: var(--success); margin-bottom: 12px;">
                        Got an idea?
                    </div>
                    <div style="font-size: 15px; color: var(--text-primary); line-height: 1.8;">
                        Stop reading. Open Ableton.<br>
                        Build for 20 minutes.<br>
                        Don't come back yet.
                    </div>
                </div>
            </div>
        </div>

        <!-- Melodic Solution -->
        <div id="solution-melodic" class="solution-page">
            <div class="back-btn" onclick="showLanding()">‚Üê Back to Problems</div>
            
            <div class="solution-header">
                <h2 class="solution-title">Melodic <span class="hero-gradient">Generator</span></h2>
                <p class="solution-subtitle">Get random melody and chord suggestions in your key</p>
            </div>

            <div class="card">
                <h3 class="card-title">Your Key & Scale</h3>
                <div class="input-grid">
                    <div>
                        <label>Key</label>
                        <select id="key-select">
                            <option>C</option>
                            <option>C#/Db</option>
                            <option>D</option>
                            <option>D#/Eb</option>
                            <option>E</option>
                            <option>F</option>
                            <option>F#/Gb</option>
                            <option>G</option>
                            <option selected>G#/Ab</option>
                            <option>A</option>
                            <option>A#/Bb</option>
                            <option>B</option>
                        </select>
                    </div>
                    <div>
                        <label>Scale</label>
                        <select id="scale-select">
                            <option selected>Minor (Natural)</option>
                            <option>Minor (Harmonic)</option>
                            <option>Minor (Melodic)</option>
                            <option>Major</option>
                            <option>Dorian</option>
                            <option>Phrygian</option>
                            <option>Mixolydian</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateMelody()">Generate Melody</button>
                <button class="btn btn-secondary" onclick="generateChords()">Generate Chords</button>
                <div id="melodic-result"></div>
            </div>

            <div class="card">
                <h3 class="card-title">Or Match a Reference Track</h3>
                <p style="margin-bottom: 16px; color: var(--text-secondary);">
                    Know the key of a track you like? Use that key:
                </p>
                <div class="input-grid">
                    <div>
                        <label>Reference Key</label>
                        <select id="ref-key-melodic">
                            <option>C</option>
                            <option>C#/Db</option>
                            <option>D</option>
                            <option>D#/Eb</option>
                            <option>E</option>
                            <option>F</option>
                            <option>F#/Gb</option>
                            <option>G</option>
                            <option selected>G#/Ab</option>
                            <option>A</option>
                            <option>A#/Bb</option>
                            <option>B</option>
                        </select>
                    </div>
                    <div>
                        <label>Reference Scale</label>
                        <select id="ref-scale-melodic">
                            <option selected>Minor</option>
                            <option>Major</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="useReferenceKey()">Use This Key</button>
            </div>
        </div>

        <!-- Loop Breaker Solution -->
        <div id="solution-loop" class="solution-page">
            <div class="back-btn" onclick="showLanding()">‚Üê Back to Problems</div>
            
            <div class="solution-header">
                <h2 class="solution-title">Break The <span class="hero-gradient">Loop</span></h2>
                <p class="solution-subtitle">Your loop will never be perfect. Lock it and build the arrangement NOW.</p>
            </div>

            <div class="card">
                <h3 class="card-title">Step 1: What do you have?</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item" onclick="toggleCheck(this)">
                        <div class="checkbox"></div>
                        <div class="checkbox-label">Drums</div>
                    </div>
                    <div class="checkbox-item" onclick="toggleCheck(this)">
                        <div class="checkbox"></div>
                        <div class="checkbox-label">Bass</div>
                    </div>
                    <div class="checkbox-item" onclick="toggleCheck(this)">
                        <div class="checkbox"></div>
                        <div class="checkbox-label">Melodic elements</div>
                    </div>
                    <div class="checkbox-item" onclick="toggleCheck(this)">
                        <div class="checkbox"></div>
                        <div class="checkbox-label">Vocals/samples</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Step 2: Lock Your Loop</h3>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    In your DAW: bounce your 8-bar loop as audio or freeze all tracks. This makes it impossible to tweak sounds.
                </p>
                <button class="btn btn-primary" onclick="startLoopBreaker()">‚úì I've Locked My Loop - Show Me What's Next</button>
            </div>

            <div class="tip-box">
                <div class="tip-title">üí° Why You're Stuck</div>
                <div class="tip-text">
                    You're trying to make the loop perfect before arranging. But arrangement creates context. 
                    You can't know if sounds work until they're in the arrangement. Build structure first, THEN polish.
                </div>
            </div>
        </div>

        <!-- Transition Solution -->
        <div id="solution-transition" class="solution-page">
            <div class="back-btn" onclick="showLanding()">‚Üê Back to Problems</div>
            
            <div class="solution-header">
                <h2 class="solution-title">Transition <span class="hero-gradient">Helper</span></h2>
                <p class="solution-subtitle">Pick a transition type based on how much energy change you need</p>
            </div>

            <div class="card">
                <h3 class="card-title">What type of transition?</h3>
                <button class="btn btn-secondary" onclick="showTransition('simple')">Simple (subtle change)</button>
                <button class="btn btn-secondary" onclick="showTransition('medium')">Medium (clear change)</button>
                <button class="btn btn-secondary" onclick="showTransition('big')">Big (dramatic drop/build)</button>
                <div id="transition-result"></div>
            </div>
        </div>

        <!-- Arrangement Solution -->
        <div id="solution-arrangement" class="solution-page">
            <div class="back-btn" onclick="showLanding()">‚Üê Back to Problems</div>
            
            <div class="solution-header">
                <h2 class="solution-title">Arrangement <span class="hero-gradient">Builder</span></h2>
                <p class="solution-subtitle">Get a complete track structure based on house music styles</p>
            </div>

            <div class="card">
                <h3 class="card-title">Choose Your Style</h3>
                <button class="btn btn-secondary" onclick="generateArrangement('maccabi')">Maccabi House (6-7 min)</button>
                <button class="btn btn-secondary" onclick="generateArrangement('hot')">Hot Creations (7-8 min)</button>
                <button class="btn btn-secondary" onclick="generateArrangement('nervous')">Nervous Records (4-5 min)</button>
                <button class="btn btn-secondary" onclick="generateArrangement('dirtybird')">Dirtybird (5-6 min)</button>
                <button class="btn btn-primary" onclick="generateArrangement('random')">üé≤ Surprise Me</button>
            </div>

            <div id="arrangement-output" style="display: none;">
                <div class="card">
                    <h3 class="card-title" id="arrangement-style-title"></h3>
                    <div id="arrangement-details"></div>
                </div>

                <div class="card">
                    <h3 class="card-title">Section Breakdown</h3>
                    <div id="arrangement-sections"></div>
                </div>

                <div class="tip-box">
                    <div class="tip-title">üí° How to Use</div>
                    <div class="tip-text">
                        1. Create markers in your DAW at each timestamp<br>
                        2. Build each section following the guidelines<br>
                        3. Don't overthink - this is a template, not rules
                    </div>
                </div>
            </div>
        </div>

        <!-- Too Much Solution -->
        <div id="solution-toomuch" class="solution-page">
            <div class="back-btn" onclick="showLanding()">‚Üê Back to Problems</div>
            
            <div class="solution-header">
                <h2 class="solution-title">Less Is <span class="hero-gradient">More</span></h2>
                <p class="solution-subtitle">Remove elements to make space. House music thrives on simplicity.</p>
            </div>

            <div class="card">
                <h3 class="card-title">How many tracks do you have?</h3>
                <div class="input-grid">
                    <div>
                        <label>Drum Tracks</label>
                        <input type="number" id="drums-input" value="5" min="0">
                    </div>
                    <div>
                        <label>Bass Tracks</label>
                        <input type="number" id="bass-input" value="2" min="0">
                    </div>
                </div>
                <div class="input-grid">
                    <div>
                        <label>Melodic Tracks</label>
                        <input type="number" id="melodic-input" value="12" min="0">
                    </div>
                    <div>
                        <label>FX/Atmosphere</label>
                        <input type="number" id="fx-input" value="4" min="0">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="analyzeTracks()">Analyze My Project</button>
                <div id="track-analysis"></div>
            </div>

            <div class="card">
                <h3 class="card-title">The Mute Test</h3>
                <ul class="action-list">
                    <li><strong>Step 1:</strong> Mute one element</li>
                    <li><strong>Step 2:</strong> Play the track</li>
                    <li><strong>Step 3:</strong> If it still sounds good, DELETE that element permanently</li>
                    <li><strong>Step 4:</strong> Repeat with every element</li>
                </ul>
            </div>

            <div class="tip-box">
                <div class="tip-title">üí° Golden Rule</div>
                <div class="tip-text">
                    House tracks usually have 3-5 main elements: kick, bass, one melodic hook, percussion. 
                    If you have more than 8 melodic layers, you have way too many.
                </div>
            </div>
        </div>

        <!-- Reference Analyzer Solution -->
        <div id="solution-reference" class="solution-page">
            <div class="back-btn" onclick="showLanding()">‚Üê Back to Problems</div>
            
            <div class="solution-header">
                <h2 class="solution-title">Reference Track <span class="hero-gradient">Analyzer</span></h2>
                <p class="solution-subtitle">Understand what makes your favorite tracks work, then apply it to yours</p>
            </div>

            <!-- Manual Analysis Section -->
            <div class="card">
                <h3 class="card-title">Reference Track Details</h3>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 24px;">
                    Enter what you know about the track you want to reference:
                </p>
                
                <div class="input-grid">
                    <div>
                        <label>BPM *</label>
                        <input type="number" id="ref-analyzer-bpm" placeholder="124" min="80" max="180">
                    </div>
                    <div>
                        <label>Track Length (minutes) *</label>
                        <input type="number" id="ref-analyzer-length" placeholder="6.5" step="0.5" min="2" max="15">
                    </div>
                </div>

                <div class="input-grid">
                    <div>
                        <label>Key</label>
                        <select id="ref-analyzer-key">
                            <option value="">Unknown</option>
                            <option>C Minor</option>
                            <option>C# Minor</option>
                            <option>D Minor</option>
                            <option>E Minor</option>
                            <option>F Minor</option>
                            <option>F# Minor</option>
                            <option>G Minor</option>
                            <option selected>G# Minor</option>
                            <option>A Minor</option>
                            <option>B Minor</option>
                            <option>C Major</option>
                            <option>D Major</option>
                            <option>E Major</option>
                            <option>F Major</option>
                            <option>G Major</option>
                            <option>A Major</option>
                            <option>B Major</option>
                        </select>
                    </div>
                    <div>
                        <label>Overall Vibe</label>
                        <select id="ref-analyzer-vibe">
                            <option>Dark & Hypnotic</option>
                            <option>Groovy & Funky</option>
                            <option>Energetic & Peak-Time</option>
                            <option>Dreamy & Atmospheric</option>
                            <option>Minimal & Tech</option>
                            <option>Vocal & Melodic</option>
                        </select>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <label>How many layers/elements? (Optional)</label>
                    <div class="input-grid">
                        <div>
                            <input type="number" id="ref-drums" placeholder="Drums (0-10)" min="0" max="20">
                        </div>
                        <div>
                            <input type="number" id="ref-bass" placeholder="Bass (0-5)" min="0" max="10">
                        </div>
                    </div>
                    <div class="input-grid">
                        <div>
                            <input type="number" id="ref-melodic" placeholder="Melodic (0-10)" min="0" max="20">
                        </div>
                        <div>
                            <input type="number" id="ref-fx" placeholder="FX/Atmos (0-10)" min="0" max="20">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="analyzeReferenceFull()">üîç Analyze Reference Track</button>
            </div>

            <div id="ref-analysis-output"></div>

            <div id="ref-comparison-section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">Compare to YOUR Track</h3>
                    <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 24px;">
                        Now tell us about YOUR track to see the gap:
                    </p>
                    
                    <div class="input-grid">
                        <div>
                            <label>Your BPM</label>
                            <input type="number" id="your-bpm" placeholder="124">
                        </div>
                        <div>
                            <label>Your Key</label>
                            <select id="your-key">
                                <option value="">Unknown</option>
                                <option>G# Minor</option>
                                <option>A Minor</option>
                                <option>C Minor</option>
                                <option>D Minor</option>
                                <option>E Minor</option>
                                <option>F Minor</option>
                                <option>C Major</option>
                                <option>D Major</option>
                                <option>G Major</option>
                                <option>A Major</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label>Your layers</label>
                        <div class="input-grid">
                            <div>
                                <input type="number" id="your-drums" placeholder="Drums">
                            </div>
                            <div>
                                <input type="number" id="your-bass" placeholder="Bass">
                            </div>
                        </div>
                        <div class="input-grid">
                            <div>
                                <input type="number" id="your-melodic" placeholder="Melodic">
                            </div>
                            <div>
                                <input type="number" id="your-fx" placeholder="FX">
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="compareToReference()">üìä Show the Gap</button>
                    <div id="comparison-output"></div>
                </div>
            </div>

            <div class="tip-box">
                <div class="tip-title">üîÆ COMING SOON: Automatic Analysis</div>
                <div class="tip-text">
                    Upload an MP3/WAV file and get automatic BPM detection, key detection, waveform visualization, section detection (intro/build/drop), energy curve analysis, and frequency breakdown. We're building this now!
                </div>
            </div>
        </div>

    </div>

    <!-- Custom Modal -->
    <div id="decision-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal()">√ó</div>
            <div class="modal-icon" id="modal-icon">üé≤</div>
            <div class="modal-title" id="modal-title">Your Next Move</div>
            <div class="modal-message" id="modal-message"></div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Not This</button>
                <button class="modal-btn modal-btn-primary" onclick="executeDecision()">LET'S GO ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div style="background: var(--bg-medium); border-top: 1px solid var(--border); padding: 60px 40px; margin-top: 80px;">
        <div style="max-width: 1400px; margin: 0 auto;">
            <!-- Philosophy -->
            <div style="text-align: center; margin-bottom: 60px;">
                <div style="font-size: 24px; font-weight: 900; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px; letter-spacing: -0.01em;">
                    THE MOMENTUM METHOD
                </div>
                <div style="font-size: 16px; color: var(--text-secondary); line-height: 1.8; max-width: 600px; margin: 0 auto;">
                    Action ‚Üí Clarity ‚Üí Confidence
                </div>
                <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border); max-width: 600px; margin-left: auto; margin-right: auto;">
                    <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.8;">
                        Not: Perfect idea ‚Üí Execute ‚Üí Done<br><br>
                        But: Imperfect action ‚Üí See what works ‚Üí Adjust<br><br>
                        <strong style="color: var(--primary);">Build. Don't judge. Keep moving.</strong>
                    </div>
                </div>
            </div>

            <!-- Human Stamp -->
            <div style="text-align: center;">
                <div style="font-size: 13px; color: var(--text-dim); font-style: italic;">
                    Built by a producer who got stuck<br>
                    more times than he can count.
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // JUST DECIDE FOR ME - Custom Modal
        // ============================================
        let currentDecision = null;

        function justDecideForMe() {
            const decisions = [
                {
                    action: 'boring',
                    icon: 'üí°',
                    title: 'ADD MOVEMENT',
                    message: 'Your next move: Automate the filter on your main element.\n\nStart at 500Hz, sweep to 2kHz over 8 bars.\n\n‚è±Ô∏è 5 minutes. Do it now.'
                },
                {
                    action: 'melodic',
                    icon: 'üéπ',
                    title: 'GENERATE A MELODY',
                    message: 'Your track needs a melodic hook.\n\nI\'m taking you to the melody generator.\n\nPick your key, generate, and add it to your track.\n\n‚è±Ô∏è 15 minutes. Go.'
                },
                {
                    action: 'loop',
                    icon: 'üîì',
                    title: 'BREAK THE LOOP',
                    message: 'Stop perfecting. Start arranging.\n\nNext 20 minutes:\n‚Ä¢ Bounce your loop as audio\n‚Ä¢ Copy it 10 times\n‚Ä¢ Remove elements for intro\n‚Ä¢ Full loop = drop\n\n‚è±Ô∏è Timer starts NOW.'
                },
                {
                    action: 'transition',
                    icon: 'üîÑ',
                    title: 'ADD A TRANSITION',
                    message: 'Your next move: White noise riser over 8 bars.\n\nAdd it before your next section.\n\nHigh-pass filter sweep too if you want.\n\n‚è±Ô∏è 10 minutes.'
                },
                {
                    action: 'earcandy',
                    icon: 'üç¨',
                    title: 'ADD EAR CANDY',
                    message: 'Your next move: Reverse hi-hat.\n\nPlace it 1 beat before your next downbeat.\n\nSmall detail, big impact.\n\n‚è±Ô∏è 5 minutes. Do it.'
                },
                {
                    action: 'arrangement',
                    icon: 'üìê',
                    title: 'GET STRUCTURE',
                    message: 'Your loop needs arrangement.\n\nI\'m taking you to the arrangement builder.\n\nPick a style and follow the sections.\n\n‚è±Ô∏è 30 minutes. Build it.'
                }
            ];
            
            currentDecision = decisions[Math.floor(Math.random() * decisions.length)];
            
            document.getElementById('modal-icon').textContent = currentDecision.icon;
            document.getElementById('modal-title').textContent = currentDecision.title;
            document.getElementById('modal-message').textContent = currentDecision.message;
            document.getElementById('decision-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('decision-modal').classList.remove('active');
            currentDecision = null;
        }

        function executeDecision() {
            if (!currentDecision) return;
            
            closeModal();
            
            if (currentDecision.action === 'melodic') {
                showSolution('melodic');
            } else if (currentDecision.action === 'loop') {
                showSolution('loop');
            } else if (currentDecision.action === 'transition') {
                showSolution('transition');
            } else if (currentDecision.action === 'arrangement') {
                showSolution('arrangement');
            } else if (currentDecision.action === 'boring') {
                showSolution('boring');
                setTimeout(() => generateTechnique('random'), 500);
            } else if (currentDecision.action === 'earcandy') {
                showSolution('boring');
                setTimeout(() => generateTechnique('earcandy'), 500);
            }
        }

        // Navigation
        function showSolution(type) {
            document.querySelectorAll('.solution-page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('solution-' + type).classList.add('active');
            window.scrollTo(0, 0);
        }

        function showLanding() {
            document.querySelectorAll('.solution-page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('landing').classList.add('active');
            window.scrollTo(0, 0);
        }

        // Checkbox toggle
        function toggleCheck(element) {
            element.classList.toggle('checked');
        }

        // Loop Breaker
        function startLoopBreaker() {
            const checked = document.querySelectorAll('#solution-loop .checkbox-item.checked');
            
            if (checked.length === 0) {
                alert('‚ö†Ô∏è TELL US WHAT YOU HAVE FIRST\n\nCheck the boxes above to tell us what elements are in your loop.\n\nThen click this button again.');
                return;
            }
            
            const hasDrums = Array.from(checked).some(el => el.textContent.includes('Drums'));
            const hasBass = Array.from(checked).some(el => el.textContent.includes('Bass'));
            const hasMelodic = Array.from(checked).some(el => el.textContent.includes('Melodic'));
            const hasVocals = Array.from(checked).some(el => el.textContent.includes('Vocals'));
            
            // Too few elements - suggest what to ADD
            if (checked.length <= 2) {
                let suggestions = 'üéØ YOUR LOOP NEEDS MORE ELEMENTS\n\n';
                suggestions += 'You only have ' + checked.length + ' element(s). Here\'s what to add:\n\n';
                
                if (!hasDrums) {
                    suggestions += '‚Üí Add DRUMS first\n   ‚Ä¢ Start with kick (4/4 pattern)\n   ‚Ä¢ Add hi-hats on offbeats\n\n';
                }
                if (!hasBass) {
                    suggestions += '‚Üí Add BASS next\n   ‚Ä¢ Root note on beat 1\n   ‚Ä¢ Simple pattern to start\n\n';
                }
                if (!hasMelodic) {
                    suggestions += '‚Üí Add a MELODIC element\n   ‚Ä¢ Go to "Melodic Ideas"\n   ‚Ä¢ Generate a simple melody\n   ‚Ä¢ This is your hook\n\n';
                }
                
                suggestions += 'Build these first, THEN come back to arrange!';
                alert(suggestions);
                return;
            }
            
            // Missing key elements
            if (!hasDrums || !hasBass) {
                alert('‚ö†Ô∏è MISSING FOUNDATION\n\nYou need drums AND bass before arranging.\n\nAdd them first, then come back.');
                return;
            }
            
            if (!hasMelodic && !hasVocals) {
                alert('üéØ ADD A MELODIC HOOK\n\nYou have drums + bass but nothing memorable.\n\nGo to "Melodic Ideas" and generate:\n‚Ä¢ A simple melody (3-5 notes)\n‚Ä¢ Or chord progression\n\nThen come back to arrange!');
                return;
            }
            
            // Ready to arrange!
            alert('‚úì LOOP IS READY!\n\nYou have: ' + Array.from(checked).map(el => el.textContent.trim()).join(', ') + '\n\nNow go to your DAW:\n\n1. Bounce/freeze your loop as audio\n2. Copy it across the timeline 10 times\n3. Remove elements for intro (bars 1-8)\n4. Add white noise riser (bars 9-16)\n5. Full loop = drop (bars 17-32)\n6. Mute kick for breakdown (bars 33-48)\n7. Build + final drop (bars 49-64)\n8. Outro = fade or repeat intro\n\nSet a 20-minute timer and BUILD IT!');
        }

        // Track Analysis
        function analyzeTracks() {
            const drums = parseInt(document.getElementById('drums-input').value) || 0;
            const bass = parseInt(document.getElementById('bass-input').value) || 0;
            const melodic = parseInt(document.getElementById('melodic-input').value) || 0;
            const fx = parseInt(document.getElementById('fx-input').value) || 0;
            const total = drums + bass + melodic + fx;

            let analysis = '';

            if (melodic > 8) {
                analysis += `<div class="tip-box" style="border-color: #f5576c;"><div class="tip-title">‚ö†Ô∏è TOO MANY MELODIC LAYERS</div><div class="tip-text">You have ${melodic} melodic tracks. House typically uses 3-5 max. Use the Mute Test to remove ${melodic - 5} of them.</div></div>`;
            } else if (melodic <= 5) {
                analysis += `<div class="tip-box" style="border-color: #43e97b;"><div class="tip-title">‚úì GOOD MELODIC BALANCE</div><div class="tip-text">${melodic} melodic tracks is healthy for house music.</div></div>`;
            }

            if (bass > 3) {
                analysis += `<div class="tip-box" style="border-color: #f5576c;"><div class="tip-title">‚ö†Ô∏è TOO MANY BASS LAYERS</div><div class="tip-text">${bass} bass tracks will cause mud. You need 1-2 max (sub + mid).</div></div>`;
            }

            if (total > 20) {
                analysis += `<div class="tip-box"><div class="tip-title">üìä TOTAL: ${total} TRACKS</div><div class="tip-text">That's a lot. Minimal house uses 10-15 total. Every extra track reduces clarity.</div></div>`;
            }

            document.getElementById('track-analysis').innerHTML = analysis;
        }

        // Transitions
        const transitions = {
            simple: [
                'Filter Sweep: Low-pass closes over 2-4 bars',
                'Kick Drop: Remove kick for last 2 bars',
                'Volume Dip: Drop volume by 3dB, then back up'
            ],
            medium: [
                'Snare Roll + Riser: Fill last 2 bars + white noise',
                'Filter + Kick Mute: Sweep + remove kick + impact on 1',
                'Vocal Chop: Repeat faster and faster, then silence'
            ],
            big: [
                'Full Breakdown: Strip to atmosphere, build 8 bars, impact drop',
                'Reverse + Silence: Reverse last bar + 1 beat silence + huge drop',
                'Vinyl Stop: Pitch down entire section, then full speed drop'
            ]
        };

        function showTransition(type) {
            const options = transitions[type];
            const transition = options[Math.floor(Math.random() * options.length)];
            document.getElementById('transition-result').innerHTML = `
                <div class="result-box">
                    <div class="result-category">${type.toUpperCase()} TRANSITION</div>
                    <div class="result-main">${transition.split(':')[0]}</div>
                    <div class="result-desc">${transition.split(':')[1]}</div>
                </div>
            `;
        }

        // Production Techniques Database
        const techniques = {
            movement: [
                { name: 'Filter Sweep Automation', desc: 'Automate low-pass filter cutoff on your main pad/synth. Start at 500Hz, sweep to 2kHz over 8 bars. Creates forward motion.' },
                { name: 'Panning Automation', desc: 'Automate shaker or hi-hat panning left to right slowly (one full cycle every 4-8 bars). Adds width and movement.' },
                { name: 'Volume Automation (Ducking)', desc: 'Slightly lower volume of pad/chords by 2-3dB every 4 bars, then bring back up. Creates breathing/pumping feel.' },
                { name: 'Pitch Bend Automation', desc: 'Subtle pitch bend (+5 cents) on bassline at end of phrase. Adds human feel and forward momentum.' },
                { name: 'Reverb Automation', desc: 'Increase reverb send on vocal/lead by 20% over 4 bars before breakdown. Makes it float away.' },
                { name: 'Stereo Width Automation', desc: 'Start synth narrow (mono), gradually widen to full stereo over 16 bars. Builds energy.' },
                { name: 'LFO on Filter', desc: 'Add slow LFO (1/4 note) to filter cutoff on pad. Subtle wobble keeps it alive.' },
                { name: 'Delay Feedback Build', desc: 'Increase delay feedback from 20% to 60% over last 2 bars before drop. Creates tension.' }
            ],
            
            earcandy: [
                { name: 'Reverse Hi-Hat', desc: 'Reverse a closed hi-hat sample, place 1 beat before downbeat. Classic house detail.' },
                { name: 'Vocal Stutter (Glitch)', desc: 'Take one syllable from vocal, repeat 4x quickly (1/16 notes). Like a glitch effect.' },
                { name: 'Reverse Cymbal Build', desc: 'Reverse crash cymbal, place it leading INTO the downbeat of new section. Creates anticipation.' },
                { name: 'Impact Hit', desc: 'Big impact/boom sound on beat 1 of new section. Announces the change.' },
                { name: 'Vinyl Stop Effect', desc: 'Pitch down + tempo slow on last bar before section change. Classic transition.' },
                { name: 'Silence Drop', desc: '1 full beat of complete silence before major drop. Creates maximum tension.' },
                { name: 'White Noise Riser', desc: 'White noise sweeping up over 8-16 bars. Add high-pass filter automation for extra build.' },
                { name: 'Clap/Snare Fill', desc: 'Quick snare roll (1/16 or 1/32 notes) on last 1-2 bars before drop.' },
                { name: 'Percussion Drop-out', desc: 'Remove all percussion except kick for 4 bars, then bring back on drop. Creates contrast.' },
                { name: 'Kick Mute', desc: 'Mute kick for last 2 bars before drop. When it comes back = massive energy.' },
                { name: 'Laser Zap Sound', desc: 'Quick synth zap/laser sound on offbeat. Adds futuristic vibe.' },
                { name: 'Record Scratch', desc: 'Quick scratch sound from vinyl sample. Place on beat 3 or 4.' }
            ],
            
            automation: [
                { name: 'High-Pass Filter Sweep', desc: 'Automate high-pass filter on entire track. Start at 20Hz, sweep to 200Hz over 2 bars before drop, then snap back to 20Hz on drop. Massive impact.' },
                { name: 'Bitcrusher Automation', desc: 'Gradually increase bitcrush on hi-hats over 8 bars (from 16bit to 8bit). Adds grit and tension.' },
                { name: 'Saturation Build', desc: 'Increase saturation/distortion on bass over 4 bars before drop. Makes it heavier.' },
                { name: 'Chorus Depth', desc: 'Automate chorus depth on synth from 0% to 50% over 8 bars. Adds thickness.' },
                { name: 'Phaser Speed', desc: 'Increase phaser rate on pad from slow to fast over breakdown. Psychedelic movement.' },
                { name: 'Compression Release', desc: 'Automate compressor release time on drums (fast to slow) during breakdown. Changes the feel.' },
                { name: 'EQ Sweep (Bell)', desc: 'Automate EQ bell boost sweeping through mids (500Hz to 2kHz) on synth. Vocal-like effect.' },
                { name: 'Tremolo Rate', desc: 'Add tremolo to pad, automate rate from 1/8 to 1/16 over 4 bars. Speeds up groove feel.' }
            ],
            
            texture: [
                { name: 'Vinyl Crackle Layer', desc: 'Add quiet vinyl crackle/noise loop underneath. Gives warmth and analog feel. Keep it at -30dB.' },
                { name: 'Field Recording', desc: 'Layer quiet ambient sound (rain, crowd, street) very low in mix. Adds depth without being obvious.' },
                { name: 'Foley Percussion', desc: 'Use real-world sounds as percussion: keys jingling, paper rustling, door closing. Makes it unique.' },
                { name: 'Background Voices', desc: 'Quiet crowd/party chatter panned wide in breakdown. Creates atmosphere.' },
                { name: 'Tape Saturation', desc: 'Add tape saturation plugin on master (very subtle). Glues everything together.' },
                { name: 'Noise Floor', desc: 'Layer white/pink noise at -40dB underneath everything. Fills gaps between transients.' },
                { name: 'Guitar Pluck (Hidden)', desc: 'Real acoustic guitar pluck buried in mix (barely audible). Adds organic texture.' },
                { name: 'Room Tone', desc: 'Record 30 seconds of your room\'s silence. Layer it quietly. Adds natural space.' },
                { name: 'Breath Sounds', desc: 'Human breath/exhale sounds placed subtly. Makes it feel alive.' },
                { name: 'Glass/Metal Hits', desc: 'Record glass clink or metal hit, use as percussion. Unexpected texture.' }
            ]
        };

        function generateTechnique(category) {
            let selectedCategory;
            
            if (category === 'random') {
                const categories = ['movement', 'earcandy', 'automation', 'texture'];
                selectedCategory = categories[Math.floor(Math.random() * categories.length)];
            } else {
                selectedCategory = category;
            }
            
            const categoryTechniques = techniques[selectedCategory];
            const technique = categoryTechniques[Math.floor(Math.random() * categoryTechniques.length)];
            
            const categoryNames = {
                'movement': 'üåä Movement',
                'earcandy': 'üç¨ Ear Candy',
                'automation': 'üéõÔ∏è Automation',
                'texture': 'üé® Texture'
            };
            
            document.getElementById('ear-candy-result').innerHTML = `
                <div class="result-box">
                    <div class="result-category">${categoryNames[selectedCategory]}</div>
                    <div class="result-main">${technique.name}</div>
                    <div class="result-desc">${technique.desc}</div>
                </div>
            `;
            
            // Track action

        }

        // Melodic - Proper scales
        const scales = {
            'Minor (Natural)': [0, 2, 3, 5, 7, 8, 10],
            'Minor (Harmonic)': [0, 2, 3, 5, 7, 8, 11],
            'Minor (Melodic)': [0, 2, 3, 5, 7, 9, 11],
            'Major': [0, 2, 4, 5, 7, 9, 11],
            'Dorian': [0, 2, 3, 5, 7, 9, 10],
            'Phrygian': [0, 1, 3, 5, 7, 8, 10],
            'Mixolydian': [0, 2, 4, 5, 7, 9, 10]
        };

        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

        function getScaleNotes(rootNote, scaleName) {
            const rootIndex = notes.indexOf(rootNote);
            const scaleIntervals = scales[scaleName];
            return scaleIntervals.map(interval => notes[(rootIndex + interval) % 12]);
        }

        function generateMelody() {
            const key = document.getElementById('key-select').value;
            const scale = document.getElementById('scale-select').value;
            const scaleNotes = getScaleNotes(key, scale);
            
            const melodyLength = 6 + Math.floor(Math.random() * 3);
            const melody = [];
            for (let i = 0; i < melodyLength; i++) {
                melody.push(scaleNotes[Math.floor(Math.random() * scaleNotes.length)]);
            }
            
            // Build piano roll visual
            const allNotes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            const octaveNotes = [...allNotes].reverse(); // C at bottom, B at top
            
            let pianoKeysHTML = '';
            let pianoGridHTML = '';
            
            octaveNotes.forEach(noteName => {
                const isInScale = scaleNotes.includes(noteName);
                const isInMelody = melody.includes(noteName);
                
                pianoKeysHTML += `<div class="piano-key ${isInMelody ? 'active' : ''}">${noteName}</div>`;
                
                // Build row for this note
                let rowHTML = '<div class="piano-row">';
                melody.forEach((melodyNote, index) => {
                    if (melodyNote === noteName) {
                        rowHTML += `<div class="piano-note" style="margin-left: ${index * 68 + 4}px;">${index + 1}</div>`;
                    }
                });
                rowHTML += '</div>';
                pianoGridHTML = rowHTML + pianoGridHTML; // Add to beginning (reverse order)
            });
            
            // Beat markers
            let beatMarkersHTML = '';
            for (let i = 0; i < melody.length; i++) {
                beatMarkersHTML += `<div class="beat-marker">${i + 1}</div>`;
            }
            
            document.getElementById('melodic-result').innerHTML = `
                <div class="result-box">
                    <div class="result-category">MELODY</div>
                    <div class="result-main">${key} ${scale}</div>
                    <div class="result-desc">Play these ${melody.length} notes in order (or any order you like):</div>
                </div>
                
                <div class="piano-roll">
                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.05em;">MIDI Preview</div>
                    <div class="piano-beat-markers">${beatMarkersHTML}</div>
                    <div class="piano-roll-grid">
                        <div class="piano-keys">${pianoKeysHTML}</div>
                        <div class="piano-grid">${pianoGridHTML}</div>
                    </div>
                </div>
                
                <div class="result-box" style="background: rgba(102, 126, 234, 0.05);">
                    <div style="font-size: 14px; color: var(--text-primary); line-height: 1.8;">
                        <strong style="color: var(--primary);">Notes:</strong> ${melody.join(' ‚Üí ')}<br>
                        <strong style="color: var(--primary);">Tip:</strong> Start and end on ${key} for a resolved feeling. Try different rhythms!
                    </div>
                </div>
            `;
            
            // Track action (removed progress bar but keep function for future)

        }

        function generateChords() {
            const key = document.getElementById('key-select').value;
            const scale = document.getElementById('scale-select').value;
            
            const progressions = scale.includes('Minor')
                ? ['i - VI - III - VII', 'i - iv - v - i', 'i - VII - VI - VII', 'i - v - VI - III']
                : ['I - V - vi - IV', 'I - IV - V - I', 'I - vi - IV - V'];
            
            const prog = progressions[Math.floor(Math.random() * progressions.length)];
            
            document.getElementById('melodic-result').innerHTML = `
                <div class="result-box">
                    <div class="result-category">CHORD PROGRESSION</div>
                    <div class="result-main">${key} ${scale}</div>
                    <div class="result-desc" style="font-size: 24px; margin: 16px 0; font-weight: 700;">${prog}</div>
                    <div class="result-desc">
                        Build triads from the scale. Play whole notes or rhythmic chords.
                    </div>
                </div>
            `;
            
            // Track action

        }

        // ============================================
        // STARTER KIT GENERATOR
        // ============================================
        const starterKits = {
            dark: {
                vibe: 'üåë Dark & Hypnotic',
                bpm: '123-126 BPM',
                key: 'G# Minor',
                desc: 'Deep, rolling basslines with minimal melodic content. Focus on groove and atmosphere.',
                elements: [
                    '<strong>1. Kick:</strong> 4/4 pattern, punchy but not too bright. Use a sub-heavy kick around 40-50Hz. Place on every beat.',
                    '<strong>2. Bass:</strong> Root note (G#) on beat 1, 5th (D#) on beat 3. Hold for 2 beats each. Add subtle filter movement (LFO at 1/8 rate).',
                    '<strong>3. Hi-Hat (Closed):</strong> 16th notes on offbeats. Keep it tight and minimal. Pan slightly right (+15%). Volume: -18dB.',
                    '<strong>4. Hi-Hat (Open):</strong> On beat 2 and 4. Short decay (200ms). Pan slightly left (-15%). Creates space.',
                    '<strong>5. Shaker:</strong> Constant 16th notes. Very quiet (-24dB). Panned hard right. Fills the groove.',
                    '<strong>6. Atmosphere Pad:</strong> G# minor chord (G# - B - D#). Long attack (1s), long release (3s). Lots of reverb. This is the vibe.',
                    '<strong>7. Sub Bass:</strong> Same as main bass but one octave lower. Pure sine wave. Barely audible but you feel it.',
                    '<strong>8. Texture:</strong> Vinyl crackle or field recording loop. Very quiet (-30dB). Adds warmth and analog feel.'
                ],
                arrangement: 'Start with kick + bass for 16 bars. Add hi-hats at bar 17. Pad enters at bar 33. Build gradually - don\'t rush.',
                references: ['Maccabi - Drums & Bass', 'Kobosil - 44 Rush', 'ANNA - Hidden Beauties']
            },
            groovy: {
                vibe: 'üï∫ Groovy & Funky',
                bpm: '122-125 BPM',
                key: 'A Minor',
                desc: 'Funky basslines with syncopated rhythms. Add swing and human feel.',
                elements: [
                    '<strong>Kick:</strong> 4/4 with slight swing. Not too heavy - leave room for bass.',
                    '<strong>Bass:</strong> Syncopated pattern: Root (A) on 1, skip 2, octave up on "and" of 2, back down on 3. Groove is key.',
                    '<strong>Shaker/Perc:</strong> Constant 16th note shaker panned slightly right. Adds movement.'
                ]
            },
            energetic: {
                vibe: '‚ö° Energetic & Peak-Time',
                bpm: '126-128 BPM',
                key: 'D Minor',
                desc: 'Big room energy with driving bassline. Festival-ready foundation.',
                elements: [
                    '<strong>Kick:</strong> Big 4/4 kick with punch. This is the star.',
                    '<strong>Bass:</strong> Root note (D) held for full bar. Add sidechain compression to kick. Simple but massive.',
                    '<strong>Clap:</strong> On beats 2 and 4. Layer 2-3 claps for thickness.'
                ]
            },
            dreamy: {
                vibe: '‚òÅÔ∏è Dreamy & Atmospheric',
                bpm: '120-123 BPM',
                key: 'F# Minor',
                desc: 'Floating pads and gentle melodies. Focus on space and emotion.',
                elements: [
                    '<strong>Kick:</strong> Soft 4/4 kick. Not too aggressive.',
                    '<strong>Bass:</strong> Sub bass on root (F#) whole notes. Very simple, just holds the low end.',
                    '<strong>Pad:</strong> F# minor chord (F# - A - C#). Long release, lots of reverb. This sets the vibe.'
                ]
            }
        };

        function generateStarterKit(vibeType) {
            let selectedVibe;
            
            if (vibeType === 'random') {
                const vibes = ['dark', 'groovy', 'energetic', 'dreamy'];
                selectedVibe = vibes[Math.floor(Math.random() * vibes.length)];
            } else {
                selectedVibe = vibeType;
            }
            
            const kit = starterKits[selectedVibe];
            
            document.getElementById('starter-vibe').textContent = kit.vibe;
            document.getElementById('starter-bpm-key').textContent = `${kit.bpm} | ${kit.key}`;
            document.getElementById('starter-description').textContent = kit.desc;
            
            const elementsHTML = kit.elements.map(el => `<li>${el}</li>`).join('');
            document.getElementById('starter-elements').innerHTML = elementsHTML;
            
            document.getElementById('starter-kit-output').style.display = 'block';
            document.getElementById('starter-kit-output').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Track action

        }

        // ============================================
        // REFERENCE TRACK ANALYSIS
        // ============================================
        function analyzeReference() {
            const bpm = document.getElementById('ref-bpm').value;
            const key = document.getElementById('ref-key').value;
            
            if (!bpm) {
                alert('‚ö†Ô∏è Enter the reference track BPM first!\n\nYou can find BPM using websites like tunebat.com or by tapping along in your DAW.');
                return;
            }
            
            let analysis = `<div class="result-box">
                <div class="result-category">REFERENCE ANALYSIS</div>
                <div class="result-main">${bpm} BPM${key ? ' | ' + key : ''}</div>
                <div class="result-desc">`;
            
            if (bpm < 120) {
                analysis += `<strong>Tempo:</strong> Slower, deep house vibe. Use this tempo for groovy, laid-back tracks.<br><br>`;
            } else if (bpm >= 120 && bpm < 125) {
                analysis += `<strong>Tempo:</strong> Classic house tempo. Perfect for melodic and groovy tracks.<br><br>`;
            } else if (bpm >= 125 && bpm < 128) {
                analysis += `<strong>Tempo:</strong> Peak-time house. Driving and energetic.<br><br>`;
            } else {
                analysis += `<strong>Tempo:</strong> Fast tech house tempo. High energy, festival ready.<br><br>`;
            }
            
            if (key) {
                const isMinor = key.includes('m') || key.includes('min');
                analysis += `<strong>Key:</strong> ${key} suggests a ${isMinor ? 'darker, emotional' : 'brighter, uplifting'} vibe.<br><br>`;
            }
            
            analysis += `<strong>Next Steps:</strong><br>
                ‚Ä¢ Use this BPM/key in your project<br>
                ‚Ä¢ Build your starter kit in this key<br>
                ‚Ä¢ Listen to the reference and count elements<br>
                ‚Ä¢ Try to match the vibe, not copy the sounds
                </div></div>`;
            
            document.getElementById('reference-output').innerHTML = analysis;
            
            // Track action

        }

        function showTransition(type) {
            const options = transitions[type];
            const transition = options[Math.floor(Math.random() * options.length)];
            document.getElementById('transition-result').innerHTML = `
                <div class="result-box">
                    <div class="result-category">${type.toUpperCase()} TRANSITION</div>
                    <div class="result-main">${transition.split(':')[0]}</div>
                    <div class="result-desc">${transition.split(':')[1]}</div>
                </div>
            `;
            
            // Track action

        }

        function analyzeTracks() {
            const drums = parseInt(document.getElementById('drums-input').value) || 0;
            const bass = parseInt(document.getElementById('bass-input').value) || 0;
            const melodic = parseInt(document.getElementById('melodic-input').value) || 0;
            const fx = parseInt(document.getElementById('fx-input').value) || 0;
            const total = drums + bass + melodic + fx;

            let analysis = '';

            if (melodic > 8) {
                analysis += `<div class="tip-box" style="border-color: #f5576c;"><div class="tip-title">‚ö†Ô∏è TOO MANY MELODIC LAYERS</div><div class="tip-text">You have ${melodic} melodic tracks. House typically uses 3-5 max. Use the Mute Test to remove ${melodic - 5} of them.</div></div>`;
            } else if (melodic <= 5) {
                analysis += `<div class="tip-box" style="border-color: #43e97b;"><div class="tip-title">‚úì GOOD MELODIC BALANCE</div><div class="tip-text">${melodic} melodic tracks is healthy for house music.</div></div>`;
            }

            if (bass > 3) {
                analysis += `<div class="tip-box" style="border-color: #f5576c;"><div class="tip-title">‚ö†Ô∏è TOO MANY BASS LAYERS</div><div class="tip-text">${bass} bass tracks will cause mud. You need 1-2 max (sub + mid).</div></div>`;
            }

            if (total > 20) {
                analysis += `<div class="tip-box"><div class="tip-title">üìä TOTAL: ${total} TRACKS</div><div class="tip-text">That's a lot. Minimal house uses 10-15 total. Every extra track reduces clarity.</div></div>`;
            }

            document.getElementById('track-analysis').innerHTML = analysis;
            
            // Track action (removed progress tracking)

        }

        // ============================================
        // ARRANGEMENT BUILDER
        // ============================================
        const arrangements = {
            maccabi: {
                name: 'Maccabi House',
                bpm: '123-126 BPM',
                duration: '6-7 minutes',
                vibe: 'Hypnotic, rolling, psytrance-influenced',
                sections: [
                    { name: 'Intro', time: '0:00-1:00', bars: '1-32', what: 'Minimal start with kick + bass. Build gradually.' },
                    { name: 'Groove Build', time: '1:00-2:30', bars: '33-80', what: 'Add percussion layers. Keep it rolling and hypnotic.' },
                    { name: 'Main Section', time: '2:30-4:00', bars: '81-128', what: 'Full energy. Bassline driving. Minimal melodic elements.' },
                    { name: 'Breakdown', time: '4:00-5:00', bars: '129-160', what: 'Strip to atmosphere. Build tension with risers.' },
                    { name: 'Second Drop', time: '5:00-6:00', bars: '161-192', what: 'Same as main but with variations. Peak energy.' },
                    { name: 'Outro', time: '6:00-7:00', bars: '193-224', what: 'Gradually remove elements. End with kick or cut.' }
                ]
            },
            hot: {
                name: 'Hot Creations',
                bpm: '125-128 BPM',
                duration: '7-8 minutes',
                vibe: 'Underground minimal tech, DJ-friendly',
                sections: [
                    { name: 'Intro', time: '0:00-1:30', bars: '1-48', what: 'Very minimal. Kick + subtle percussion. DJ intro.' },
                    { name: 'Kick Entry', time: '1:30-2:30', bars: '49-80', what: 'Bassline enters. Keep it groovy and minimal.' },
                    { name: 'Main Groove', time: '2:30-5:00', bars: '81-160', what: 'Main section. Hypnotic groove. Small variations every 16 bars.' },
                    { name: 'Breakdown', time: '5:00-6:00', bars: '161-192', what: 'Filter down. Atmospheric. Build slowly.' },
                    { name: 'Second Section', time: '6:00-7:00', bars: '193-224', what: 'Similar to main but slightly different elements.' },
                    { name: 'Outro', time: '7:00-8:00', bars: '225-256', what: 'Long DJ-friendly outro. Minimal elements.' }
                ]
            },
            nervous: {
                name: 'Nervous Records',
                bpm: '122-126 BPM',
                duration: '4-5 minutes',
                vibe: 'Classic house with vocals, energetic',
                sections: [
                    { name: 'Intro', time: '0:00-0:30', bars: '1-16', what: 'Short intro. Kick + groove immediately.' },
                    { name: 'Verse Build', time: '0:30-1:30', bars: '17-48', what: 'Vocals enter. Build energy with layers.' },
                    { name: 'First Drop', time: '1:30-2:30', bars: '49-80', what: 'Full energy. Hook + vocals. This is the money shot.' },
                    { name: 'Breakdown', time: '2:30-3:00', bars: '81-96', what: 'Quick break. Vocals acapella or filtered.' },
                    { name: 'Final Drop', time: '3:00-4:00', bars: '97-128', what: 'Same as first drop but bigger. Peak moment.' },
                    { name: 'Outro', time: '4:00-5:00', bars: '129-160', what: 'Fade or quick cut. Radio-friendly ending.' }
                ]
            },
            dirtybird: {
                name: 'Dirtybird',
                bpm: '125-130 BPM',
                duration: '5-6 minutes',
                vibe: 'Wonky bass house, quirky samples, festival energy',
                sections: [
                    { name: 'Intro', time: '0:00-0:45', bars: '1-24', what: 'Weird samples, wonky percussion. Set the vibe.' },
                    { name: 'Groove Build', time: '0:45-1:30', bars: '25-48', what: 'Bass enters with character. Keep it funky.' },
                    { name: 'First Drop', time: '1:30-2:30', bars: '49-80', what: 'Full wonky energy. Heavy bass, quirky elements.' },
                    { name: 'Breakdown', time: '2:30-3:15', bars: '81-104', what: 'Strip to weird samples. Build with risers.' },
                    { name: 'Build', time: '3:15-3:45', bars: '105-120', what: 'Tension build. Filter sweeps. Snare rolls.' },
                    { name: 'Final Drop', time: '3:45-5:00', bars: '121-160', what: 'Biggest energy. Add new wonky element.' },
                    { name: 'Outro', time: '5:00-6:00', bars: '161-192', what: 'Fade with quirky ending or hard cut.' }
                ]
            }
        };

        function generateArrangement(style) {
            let selectedStyle;
            
            if (style === 'random') {
                const styles = ['maccabi', 'hot', 'nervous', 'dirtybird'];
                selectedStyle = styles[Math.floor(Math.random() * styles.length)];
            } else {
                selectedStyle = style;
            }
            
            const arr = arrangements[selectedStyle];
            
            document.getElementById('arrangement-style-title').textContent = arr.name + ' Structure';
            
            document.getElementById('arrangement-details').innerHTML = `
                <div style="background: var(--bg-medium); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 13px;">
                        <div><strong style="color: var(--primary);">BPM:</strong> ${arr.bpm}</div>
                        <div><strong style="color: var(--primary);">Length:</strong> ${arr.duration}</div>
                        <div style="grid-column: 1 / -1;"><strong style="color: var(--primary);">Vibe:</strong> ${arr.vibe}</div>
                    </div>
                </div>
            `;
            
            let sectionsHTML = '';
            arr.sections.forEach((section, index) => {
                sectionsHTML += `
                    <div style="background: var(--bg-medium); border-left: 3px solid var(--primary); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div style="font-size: 16px; font-weight: 700; color: var(--text-primary);">${index + 1}. ${section.name}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${section.time}</div>
                        </div>
                        <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Bars ${section.bars}</div>
                        <div style="font-size: 14px; color: var(--text-primary); line-height: 1.6;">${section.what}</div>
                    </div>
                `;
            });
            
            document.getElementById('arrangement-sections').innerHTML = sectionsHTML;
            document.getElementById('arrangement-output').style.display = 'block';
            document.getElementById('arrangement-output').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ============================================
        // DEEP REFERENCE TRACK ANALYZER
        // ============================================
        function analyzeReferenceDeep() {
            const bpm = parseInt(document.getElementById('ref-bpm-blank').value);
            const key = document.getElementById('ref-key-blank').value;
            const length = parseFloat(document.getElementById('ref-length').value);
            const vibe = document.getElementById('ref-vibe').value;
            
            if (!bpm || !length) {
                alert('‚ö†Ô∏è Enter at least BPM and track length!');
                return;
            }
            
            // Calculate bars
            const bars = Math.round((length * 60 * bpm) / 4);
            
            // Tempo analysis
            let tempoCategory = '';
            let tempoAdvice = '';
            if (bpm < 120) {
                tempoCategory = 'Deep House / Slow Groover';
                tempoAdvice = 'This tempo is hypnotic and groove-focused. Build slowly, let elements breathe. Focus on bass and rhythm.';
            } else if (bpm >= 120 && bpm < 125) {
                tempoCategory = 'Classic House';
                tempoAdvice = 'Perfect for melodic elements and vocals. Standard house tempo - great for learning arrangements.';
            } else if (bpm >= 125 && bpm < 128) {
                tempoCategory = 'Peak-Time / Tech House';
                tempoAdvice = 'High energy. Driving basslines work best. Keep it punchy and minimal - less is more at this tempo.';
            } else {
                tempoCategory = 'Fast Tech House';
                tempoAdvice = 'Festival energy. Strip back melodic elements - focus on percussion and groove. Energy over complexity.';
            }
            
            // Key analysis
            let keyAdvice = key ? `${key} suggests a ${key.includes('Minor') ? 'darker, emotional' : 'brighter, uplifting'} vibe. Use this key in your track for similar mood.` : 'Key unknown - focus on the groove and rhythm first.';
            
            // Estimated arrangement based on length
            let suggestedStructure = '';
            if (length < 5) {
                suggestedStructure = `
                    <strong>SHORT FORMAT (Radio/Streaming)</strong><br>
                    ‚Ä¢ Intro: 16 bars<br>
                    ‚Ä¢ Build: 16 bars<br>
                    ‚Ä¢ Drop: 32 bars<br>
                    ‚Ä¢ Breakdown: 16 bars<br>
                    ‚Ä¢ Final Drop: 16 bars<br>
                    ‚Ä¢ Outro: 16 bars
                `;
            } else if (length >= 5 && length < 7) {
                suggestedStructure = `
                    <strong>CLUB FORMAT (DJ-Friendly)</strong><br>
                    ‚Ä¢ Intro: 32 bars<br>
                    ‚Ä¢ Build: 32 bars<br>
                    ‚Ä¢ Main Section: 64 bars<br>
                    ‚Ä¢ Breakdown: 32 bars<br>
                    ‚Ä¢ Second Drop: 32 bars<br>
                    ‚Ä¢ Outro: 32 bars
                `;
            } else {
                suggestedStructure = `
                    <strong>EXTENDED FORMAT (Underground/Progressive)</strong><br>
                    ‚Ä¢ Long Intro: 48 bars<br>
                    ‚Ä¢ Groove Build: 48 bars<br>
                    ‚Ä¢ Main Section: 80 bars<br>
                    ‚Ä¢ Breakdown: 48 bars<br>
                    ‚Ä¢ Second Section: 64 bars<br>
                    ‚Ä¢ Long Outro: 48 bars
                `;
            }
            
            // Element suggestions based on vibe
            let elementSuggestions = '';
            if (vibe.includes('Dark')) {
                elementSuggestions = 'Focus on: Sub bass, minimal melodic elements, rolling percussion. Keep it hypnotic.';
            } else if (vibe.includes('Groovy')) {
                elementSuggestions = 'Focus on: Syncopated bass, funky percussion, vocal samples. Make it danceable.';
            } else if (vibe.includes('Energetic')) {
                elementSuggestions = 'Focus on: Driving kick, big bassline, layered claps. Peak-time energy.';
            } else if (vibe.includes('Dreamy')) {
                elementSuggestions = 'Focus on: Pads, atmospheric elements, gentle melodies. Create space.';
            } else {
                elementSuggestions = 'Focus on: Kick, bass, minimal melodic hook, subtle percussion.';
            }
            
            const output = `
                <div class="result-box" style="margin-top: 24px;">
                    <div class="result-category">REFERENCE ANALYSIS</div>
                    <div class="result-main">${bpm} BPM | ${length} min | ~${bars} bars</div>
                </div>
                
                <div style="background: var(--bg-medium); padding: 20px; border-radius: 12px; margin-top: 16px;">
                    <div style="font-size: 14px; color: var(--text-primary); line-height: 1.8;">
                        <div style="margin-bottom: 16px;">
                            <strong style="color: var(--primary);">Tempo Category:</strong> ${tempoCategory}<br>
                            <span style="color: var(--text-secondary);">${tempoAdvice}</span>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <strong style="color: var(--primary);">Key Analysis:</strong><br>
                            <span style="color: var(--text-secondary);">${keyAdvice}</span>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <strong style="color: var(--primary);">Suggested Structure:</strong><br>
                            <span style="color: var(--text-secondary);">${suggestedStructure}</span>
                        </div>
                        
                        <div>
                            <strong style="color: var(--primary);">Element Focus:</strong><br>
                            <span style="color: var(--text-secondary);">${elementSuggestions}</span>
                        </div>
                    </div>
                </div>
                
                <div class="tip-box" style="margin-top: 16px;">
                    <div class="tip-title">üéØ NEXT STEPS</div>
                    <div class="tip-text">
                        1. Use ${bpm} BPM ${key ? 'in ' + key : ''} for your track<br>
                        2. Follow the suggested structure above<br>
                        3. Listen to your reference and count how many elements it has<br>
                        4. Match the vibe, not the sounds
                    </div>
                </div>
            `;
            
            document.getElementById('reference-output-blank').innerHTML = output;
        }

        // ============================================
        // FULL REFERENCE ANALYZER (Dedicated Page)
        // ============================================
        function analyzeReferenceFull() {
            const bpm = parseInt(document.getElementById('ref-analyzer-bpm').value);
            const length = parseFloat(document.getElementById('ref-analyzer-length').value);
            const key = document.getElementById('ref-analyzer-key').value;
            const vibe = document.getElementById('ref-analyzer-vibe').value;
            
            const refDrums = parseInt(document.getElementById('ref-drums').value) || 0;
            const refBass = parseInt(document.getElementById('ref-bass').value) || 0;
            const refMelodic = parseInt(document.getElementById('ref-melodic').value) || 0;
            const refFx = parseInt(document.getElementById('ref-fx').value) || 0;
            
            if (!bpm || !length) {
                alert('‚ö†Ô∏è Enter at least BPM and track length!');
                return;
            }
            
            // Calculate bars
            const bars = Math.round((length * 60 * bpm) / 4);
            
            // Tempo analysis
            let tempoCategory, tempoAdvice;
            if (bpm < 120) {
                tempoCategory = 'Deep House / Slow Groover';
                tempoAdvice = 'This tempo is hypnotic and groove-focused. Build slowly, let elements breathe. Focus on bass and rhythm over melody.';
            } else if (bpm >= 120 && bpm < 125) {
                tempoCategory = 'Classic House';
                tempoAdvice = 'Perfect for melodic elements and vocals. Standard house tempo - great for learning arrangements. Balanced energy.';
            } else if (bpm >= 125 && bpm < 128) {
                tempoCategory = 'Peak-Time / Tech House';
                tempoAdvice = 'High energy. Driving basslines work best. Keep it punchy and minimal - less is more at this tempo.';
            } else {
                tempoCategory = 'Fast Tech House / Techno';
                tempoAdvice = 'Festival energy. Strip back melodic elements - focus on percussion and groove. Energy over complexity.';
            }
            
            // Key mood
            let keyMood = key ? (key.includes('Minor') ? 'darker, emotional, introspective' : 'brighter, uplifting, euphoric') : 'unknown';
            
            // Structure suggestion
            let structure;
            if (length < 5) {
                structure = `
                    <strong>SHORT FORMAT (Radio/Streaming)</strong><br>
                    ‚Ä¢ Intro: 0:00-0:30 (16 bars)<br>
                    ‚Ä¢ Build: 0:30-1:00 (16 bars)<br>
                    ‚Ä¢ Drop: 1:00-2:00 (32 bars)<br>
                    ‚Ä¢ Breakdown: 2:00-2:30 (16 bars)<br>
                    ‚Ä¢ Final Drop: 2:30-3:30 (32 bars)<br>
                    ‚Ä¢ Outro: 3:30-4:00 (16 bars)
                `;
            } else if (length >= 5 && length < 7) {
                structure = `
                    <strong>CLUB FORMAT (DJ-Friendly)</strong><br>
                    ‚Ä¢ Intro: 0:00-1:00 (32 bars)<br>
                    ‚Ä¢ Build: 1:00-2:00 (32 bars)<br>
                    ‚Ä¢ Main Section: 2:00-4:00 (64 bars)<br>
                    ‚Ä¢ Breakdown: 4:00-5:00 (32 bars)<br>
                    ‚Ä¢ Second Drop: 5:00-6:00 (32 bars)<br>
                    ‚Ä¢ Outro: 6:00-7:00 (32 bars)
                `;
            } else {
                structure = `
                    <strong>EXTENDED FORMAT (Underground)</strong><br>
                    ‚Ä¢ Long Intro: 0:00-1:30 (48 bars)<br>
                    ‚Ä¢ Groove Build: 1:30-3:00 (48 bars)<br>
                    ‚Ä¢ Main Section: 3:00-5:30 (80 bars)<br>
                    ‚Ä¢ Breakdown: 5:30-7:00 (48 bars)<br>
                    ‚Ä¢ Second Section: 7:00-9:00 (64 bars)<br>
                    ‚Ä¢ Long Outro: 9:00-10:30 (48 bars)
                `;
            }
            
            // Element analysis
            let elementAdvice = '';
            const totalLayers = refDrums + refBass + refMelodic + refFx;
            if (totalLayers > 0) {
                elementAdvice = `
                    <div style="margin-top: 16px; padding: 16px; background: var(--bg-dark); border-radius: 8px;">
                        <strong style="color: var(--primary);">Element Breakdown:</strong><br>
                        <div style="margin-top: 12px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 14px;">
                            <div>ü•Å Drums: ${refDrums} layers</div>
                            <div>üé∏ Bass: ${refBass} layers</div>
                            <div>üéπ Melodic: ${refMelodic} layers</div>
                            <div>‚ú® FX/Atmos: ${refFx} layers</div>
                        </div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); color: var(--text-secondary); font-size: 13px;">
                            <strong>Total: ${totalLayers} layers</strong> - ${totalLayers < 10 ? 'Minimal and focused ‚úì' : totalLayers < 15 ? 'Healthy complexity ‚úì' : 'Dense mix ‚ö†Ô∏è'}
                        </div>
                    </div>
                `;
            }
            
            const output = `
                <div class="result-box" style="margin-top: 24px;">
                    <div class="result-category">REFERENCE ANALYSIS</div>
                    <div class="result-main">${bpm} BPM ${key ? '| ' + key : ''} | ${length} min</div>
                    <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">Approximately ${bars} bars total</div>
                </div>
                
                <div class="card">
                    <div style="font-size: 14px; line-height: 1.8;">
                        <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border);">
                            <strong style="color: var(--primary); font-size: 16px;">üéµ Tempo</strong><br>
                            <div style="margin-top: 8px; color: var(--text-primary);">${tempoCategory}</div>
                            <div style="margin-top: 4px; color: var(--text-secondary); font-size: 13px;">${tempoAdvice}</div>
                        </div>
                        
                        ${key ? `
                        <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border);">
                            <strong style="color: var(--primary); font-size: 16px;">üéπ Key & Mood</strong><br>
                            <div style="margin-top: 8px; color: var(--text-primary);">${key} - ${keyMood} vibe</div>
                            <div style="margin-top: 4px; color: var(--text-secondary); font-size: 13px;">Use this key in your track for similar emotional impact.</div>
                        </div>
                        ` : ''}
                        
                        <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border);">
                            <strong style="color: var(--primary); font-size: 16px;">üìê Suggested Structure</strong><br>
                            <div style="margin-top: 12px; color: var(--text-secondary); font-size: 13px; line-height: 1.8;">
                                ${structure}
                            </div>
                        </div>
                        
                        <div>
                            <strong style="color: var(--primary); font-size: 16px;">üé® Vibe Focus: ${vibe}</strong><br>
                            <div style="margin-top: 8px; color: var(--text-secondary); font-size: 13px;">
                                ${getVibeAdvice(vibe)}
                            </div>
                        </div>
                        
                        ${elementAdvice}
                    </div>
                </div>
                
                <div class="tip-box">
                    <div class="tip-title">üéØ NEXT STEPS</div>
                    <div class="tip-text">
                        1. Set your project to ${bpm} BPM${key ? ' in ' + key : ''}<br>
                        2. Create markers in your DAW following the structure above<br>
                        3. ${totalLayers > 0 ? 'Aim for similar element count: ' + totalLayers + ' layers' : 'Listen and count layers in the reference'}<br>
                        4. Match the VIBE, not the sounds
                    </div>
                </div>
            `;
            
            document.getElementById('ref-analysis-output').innerHTML = output;
            document.getElementById('ref-comparison-section').style.display = 'block';
            document.getElementById('ref-analysis-output').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function getVibeAdvice(vibe) {
            const advice = {
                'Dark & Hypnotic': 'Focus on: Sub bass, minimal melodic elements, rolling percussion, filter automation. Keep it hypnotic and deep.',
                'Groovy & Funky': 'Focus on: Syncopated bass, funky percussion, vocal samples, swing feel. Make it danceable and bouncy.',
                'Energetic & Peak-Time': 'Focus on: Driving kick, powerful bassline, layered claps, big risers. Maximum energy.',
                'Dreamy & Atmospheric': 'Focus on: Lush pads, gentle melodies, reverb, soft percussion. Create space and emotion.',
                'Minimal & Tech': 'Focus on: Clean kick, tight bass, sparse percussion, subtle movement. Less is more.',
                'Vocal & Melodic': 'Focus on: Strong vocal hook, clear melody, supporting chords, balanced arrangement. Radio-ready.'
            };
            return advice[vibe] || 'Listen closely to understand the core elements that define this vibe.';
        }

        function compareToReference() {
            const yourBPM = parseInt(document.getElementById('your-bpm').value);
            const yourKey = document.getElementById('your-key').value;
            const yourDrums = parseInt(document.getElementById('your-drums').value) || 0;
            const yourBass = parseInt(document.getElementById('your-bass').value) || 0;
            const yourMelodic = parseInt(document.getElementById('your-melodic').value) || 0;
            const yourFx = parseInt(document.getElementById('your-fx').value) || 0;
            
            const refBPM = parseInt(document.getElementById('ref-analyzer-bpm').value);
            const refKey = document.getElementById('ref-analyzer-key').value;
            const refDrums = parseInt(document.getElementById('ref-drums').value) || 0;
            const refBass = parseInt(document.getElementById('ref-bass').value) || 0;
            const refMelodic = parseInt(document.getElementById('ref-melodic').value) || 0;
            const refFx = parseInt(document.getElementById('ref-fx').value) || 0;
            
            let gaps = [];
            
            // BPM comparison
            if (yourBPM && Math.abs(yourBPM - refBPM) > 3) {
                gaps.push(`<strong>‚ö†Ô∏è BPM Mismatch:</strong> You're at ${yourBPM}, reference is ${refBPM}. ${yourBPM < refBPM ? 'Speed up' : 'Slow down'} by ${Math.abs(yourBPM - refBPM)} BPM.`);
            } else if (yourBPM) {
                gaps.push(`<strong>‚úì BPM Match:</strong> You're in the same tempo range.`);
            }
            
            // Key comparison
            if (yourKey && refKey && yourKey !== refKey) {
                gaps.push(`<strong>üéπ Different Key:</strong> You're in ${yourKey}, reference is ${refKey}. Consider matching for similar vibe.`);
            } else if (yourKey && refKey) {
                gaps.push(`<strong>‚úì Key Match:</strong> Same key = same emotional impact.`);
            }
            
            // Element comparison
            const yourTotal = yourDrums + yourBass + yourMelodic + yourFx;
            const refTotal = refDrums + refBass + refMelodic + refFx;
            
            if (refTotal > 0) {
                const drumDiff = yourDrums - refDrums;
                const bassDiff = yourBass - refBass;
                const melodicDiff = yourMelodic - refMelodic;
                const fxDiff = yourFx - refFx;
                
                if (drumDiff > 2) gaps.push(`<strong>‚ö†Ô∏è Too Many Drums:</strong> You have ${yourDrums}, reference has ${refDrums}. Remove ${drumDiff} drum layers.`);
                if (drumDiff < -2) gaps.push(`<strong>ü•Å Add Drums:</strong> You have ${yourDrums}, reference has ${refDrums}. Add ${Math.abs(drumDiff)} more drum layers.`);
                
                if (bassDiff > 1) gaps.push(`<strong>‚ö†Ô∏è Too Much Bass:</strong> You have ${yourBass}, reference has ${refBass}. Simplify bass.`);
                if (bassDiff < -1) gaps.push(`<strong>üé∏ Add Bass:</strong> You need ${Math.abs(bassDiff)} more bass layer(s).`);
                
                if (melodicDiff > 3) gaps.push(`<strong>‚ö†Ô∏è Too Many Melodic Elements:</strong> You have ${yourMelodic}, reference has ${refMelodic}. Remove ${melodicDiff} melodic layers.`);
                if (melodicDiff < -3) gaps.push(`<strong>üéπ Add Melody:</strong> You need ${Math.abs(melodicDiff)} more melodic elements.`);
                
                if (Math.abs(yourTotal - refTotal) > 5) {
                    gaps.push(`<strong>üìä Overall Density:</strong> You have ${yourTotal} total layers, reference has ${refTotal}. ${yourTotal > refTotal ? 'Simplify' : 'Add more layers'}.`);
                }
            }
            
            if (gaps.length === 0) {
                gaps.push('<strong>‚úì You\'re on track!</strong> Your track matches the reference well.');
            }
            
            const output = `
                <div class="result-box" style="margin-top: 24px;">
                    <div class="result-category">THE GAP</div>
                    <div class="result-main">Your Track vs Reference</div>
                </div>
                
                <div class="card" style="background: rgba(102, 126, 234, 0.05);">
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        ${gaps.map(gap => `<li style="padding: 12px; margin-bottom: 8px; background: var(--bg-medium); border-radius: 8px; font-size: 14px; line-height: 1.7;">${gap}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="card" style="background: rgba(67, 233, 123, 0.05); border-color: var(--success);">
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 18px; font-weight: 700; color: var(--success); margin-bottom: 12px;">
                            Ready to close the gap?
                        </div>
                        <div style="font-size: 15px; color: var(--text-primary); line-height: 1.8;">
                            Stop analyzing. Open Ableton.<br>
                            Make the changes above.<br>
                            20 minutes. Go.
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('comparison-output').innerHTML = output;
            document.getElementById('comparison-output').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    </script>
</body>
</html>
